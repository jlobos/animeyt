Tawea.log=function(a,b){this.models.session.debug&&console.log(a,b)};var Communicator={Iframe:function(){this.messagesReceived=[],this.messagesSent=[],this.messagesFlow=[]},DebugArray:function(a){this.data=[],this.count=0,this.type=a,this.push=function(a){this.data.push(a);var b={event:Events.consoleDebug,data:{type:this.type,count:this.count,message:a}};this.count++;var c="TaweaDebug_"+this.type+"_"+Tawea.worker.idIframe;localStorage[c]=JSON.stringify(b)},Tawea.models.session.debug&&window.addEventListener("storage",function(a){var b="TaweaDebug_"+this.type+"_"+Tawea.worker.idIframe;if(a.key==b&&"Init"==a.newValue){var c={event:Events.iframeData,data:{type:this.type,count:this.count,messages:this.data}};this.count++,localStorage[b]=JSON.stringify(c)}}.bind(this),!1)},setProto:function(a,b,c){a.prototype=b,a.prototype.constructor=a,a.prototype._super=c},setProtoIframe:function(a){this.setProto(a,new Communicator.iframe,Communicator.Iframe.prototype)},iframe:function(){}};Communicator.Iframe.prototype.send=function(a,b){Tawea.models.session.debug&&(a.flowType="Sent",b.messagesSent.push(a),b.messagesFlow.push(a))},Communicator.Iframe.prototype.onMsg=function(a,b){var c=JSON.parse(a);return"object"==typeof c&&Tawea.models.session.debug&&(c.flowType="Received",b.messagesReceived.push(c),b.messagesFlow.push(c)),c};var WebWorker=function(){Communicator.Iframe.call(this),this.worker=null,window.hasOwnProperty("SharedWorker")&&this.init()};Communicator.setProtoIframe(WebWorker),WebWorker.prototype.onMsg=function(a){var b=this._super.onMsg(a.data,this);if(null!=b){if("object"==typeof b)if(b.event==Events.workerRunning||b.event==Events.workerReady)this.sayHi(),Tawea.worker.idIframe=b.data.idIframe,Tawea.tab.changeVisibility(Tawea.models.session.visibility),b.data.statusCode+""!=Tawea.models.session.statusCode+""&&this.setSession();else if(b.event==Events.iframeData){var c=!1;b.data.hasOwnProperty("boxStatus")&&(c=b.data.boxStatus),Tawea.models.session.autoHide&&!c&&Tawea.brotherhood.setOver(!Tawea.models.session.autoHide)}else if(b.event==Events.session){Tawea.models.session.get("visibility")!=b.data.visibility&&Tawea.tab.changeVisibility(b.data.visibility,!0);var d="autoHide";200==b.data.statusCode?(Tawea.models.session.set("id",b.data.id),Tawea.models.session.set("name",b.data.name),Tawea.models.session.set("facebookAccessToken",b.data.facebookAccessToken),Tawea.models.session.set("taweaAccessToken",b.data.taweaAccessToken),Tawea.models.session.set("appId",b.data.appId),Tawea.models.session.set("autoHide",b.data.autoHide),localStorage[d]=b.data.autoHide):localStorage.hasOwnProperty(d)?Tawea.models.session.set(d,JSON.parse(localStorage[d])):Tawea.models.session.set(d,!0),Tawea.models.session.set("statusCode",b.data.statusCode),Tawea.models.session.set("visibility",b.data.visibility),401==b.data.statusCode&&"Toolbar"!=Tawea.models.session.iframeType&&Tawea.tab.closeIframe()}else b.event==Events.iframeVisibility?Tawea.tab.send(b):b.event==Events.workerException&&console.error("Error: %s\n%s\n%s",b.data.message,b.data.name,b.data.stack);this.onMessage(b)}},WebWorker.prototype.onMessage=function(a){self.addEventListener("load",function(){this.onMessage(a)}.bind(this),!1)},WebWorker.prototype.init=function(){this.worker=new SharedWorker(workerUrl,workerScope),this.worker.port.addEventListener("message",function(a){this.onMsg(a)}.bind(this),!1),this.worker.port.start(),self.onbeforeunload=this.closeIframe.bind(this)},WebWorker.prototype.send=function(a){this._super.send(a,this),this.worker.port.postMessage(JSON.stringify(a))},WebWorker.prototype.registerMouseAction=function(a){if(200==Tawea.models.session.statusCode){var b={event:Events.statsMouse,data:{iframeType:Tawea.models.session.iframeType,clickType:a.type,button:a.button,clientX:a.clientX,clientY:a.clientY,screenX:a.screenX,screenY:a.screenY,statusCode:Tawea.models.session.statusCode,route:window.location.hash}};this.send(b)}},WebWorker.prototype.sayHi=function(){var a={event:Events.iframeHi,data:{idTab:"",url:Tawea.models.session.url,type:Tawea.models.session.iframeType,session:{statusCode:Tawea.models.session.statusCode}}};Tawea.models.hasOwnProperty("friend")&&(a.data.friendId=Tawea.models.friend.id.replace(/ /g,"+")),this.send(a)},WebWorker.prototype.setSession=function(){var a={event:Events.session,data:Tawea.models.session};this.send(a)},WebWorker.prototype.setBadgeText=function(a){var b={event:Events.setBadgeText,data:{text:a}};this.send(b)},WebWorker.prototype.closeIframe=function(a){var a={event:Events.iframeBye};this.send(a)},WebWorker.prototype.changeVisibility=function(a){var b={event:Events.iframeVisibility,data:{visibility:a}};this.send(b)},WebWorker.prototype.initTawea=function(){if(200==Tawea.models.session.statusCode){navigator.userAgent.toLowerCase().indexOf("safari")>=0&&navigator.userAgent.toLowerCase().indexOf("chrome")<0;var a={event:Events.taweaInit,data:{session:Tawea.models.session,domain:window.location.host,notWebSocket:!0,debug:!("tawea.com"==window.location.host||"www.tawea.com"==window.location.host)}};this.send(a)}},WebWorker.prototype.openPopup=function(a,b,c,d,e){var f={event:Events.popupOpen,data:{url:a,name:b,specs:c,replace:d,extra:e}};this.send(f)};var Tab=function(a){Communicator.Iframe.call(this),this.windowProxy=null,Tawea.models.session.debug&&(this.messagesFlow=new Communicator.DebugArray("PostMessage")),this.init(a)};Communicator.setProtoIframe(Tab),Tab.prototype.onMsg=function(a){var b=this._super.onMsg(a.data,this);b.event!=Events.iframeOver||Tawea.models.iframe.ignore||Tawea.brotherhood.sendOver(b.data.over),b.event==Events.dragEvent?"dragend"==b.data.type&&Tawea.brotherhood.sendOver(!1):Tawea.models.session.debug&&b.event==Events.consoleOpen&&Tawea.worker.openPopup("http://"+window.location.host+"/extension/debugIframe.php?id="+Tawea.worker.idIframe+"&iframeType="+Tawea.models.session.iframeType+"&type="+b.data.type,"Debug "+Tawea.models.session.iframeType+" "+Tawea.worker.idIframe,"width=1280,height=1024,top=0,left=0"),this.onMessage(b)},Tab.prototype.onMessage=function(){},Tab.prototype.init=function(a){this.windowProxy=new Porthole.WindowProxy(a),this.windowProxy.addEventListener(function(a){this.onMsg(a)}.bind(this))},Tab.prototype.send=function(a){this._super.send(a,this),this.windowProxy.post(JSON.stringify(a))},Tab.prototype.changeVisibility=function(a){var b={event:Events.iframeVisibility,data:{visibility:a,omg:!0}};this.send(b)},Tab.prototype.setBoundsIframe=function(a){var b={event:Events.iframeBounds,data:{bounds:a}};this.send(b)},Tab.prototype.onFocus=function(){Tawea.models.session.set("focus",!0)},Tab.prototype.onBlur=function(){Tawea.models.session.set("focus",!1)},Tab.prototype.closeIframe=function(a){var a={event:Events.iframeClose};this.send(a)},Tab.prototype.doLogin=function(){var a=440,b=214,c=screen.width/2-a/2,d=screen.height/2-b/2;window.open("http://"+window.location.host+"/extension/prelogin.php","popup_id","width="+a+",height="+b+",top="+d+",left="+c)},Tab.prototype.reportError=function(){var a=400,b=200,c=screen.width/2-a/2,d=screen.height/2-b/2,e=window.open("http://"+window.location.host+"/extension/report.php","popup_id","width="+a+",height="+b+",top="+d+",left="+c);e.isPopup=!0},Tab.prototype.doLogout=function(){this.openIframe("Logout","logout")},Tab.prototype.doSettings=function(a){this.openIframe("Settings","settings&settings="+JSON.stringify(a))},Tab.prototype.openIframe=function(a,b){var c=document.createElement("iframe"),d=a+"_"+Math.floor(1e9*Math.random()+1);c.style.display="none",c.id=d,c.name=d,c.src="http://"+document.location.host+"?m="+b+"&idiframe="+d,document.body.appendChild(c)};var Brotherhood=function(){Communicator.Iframe.call(this),Tawea.models.session.debug&&(this.messagesFlow=new Communicator.DebugArray("Brotherhood")),this.key="TaweaTab",this.count=0,this.init(),this.overTimeout=null};Communicator.setProtoIframe(Brotherhood),Brotherhood.prototype.onMsg=function(a){var b=this._super.onMsg(a,this);b.event!=Events.iframeOver||Tawea.models.iframe.ignore||Tawea.models.dragBox.drag||(null!=this.overTimeout&&clearTimeout(this.overTimeout),this.setOver(b.data.over)),this.onMessage(b)},Brotherhood.prototype.onMessage=function(){},Brotherhood.prototype.init=function(){window.addEventListener("storage",function(a){a.key==this.key&&this.onMsg(a.newValue)}.bind(this),!1);var a="autoHide";200!=Tawea.models.session.get("statusCode")&&(localStorage.hasOwnProperty(a)?Tawea.models.session.set(a,JSON.parse(localStorage[a])):Tawea.models.session.set(a,!0)),Tawea.models.session.autoHide&&this.sendOver(!1)},Brotherhood.prototype.send=function(a){this._super.send(a,this),a.sessionId=Tawea.worker.idIframe+"_"+this.count,this.count++,sessionStorage[this.key]=JSON.stringify(a)},Brotherhood.prototype.sendOver=function(a,b){null!=this.overTimeout&&clearTimeout(this.overTimeout);var c=300;a&&(c=0),this.overTimeout=setTimeout(function(){if(!Tawea.models.iframe.ignore||b){var c={event:Events.iframeOver,data:{over:a}};this.instance.send(c),this.instance.setOver(a)}}.bind({instance:this,force:b}),c)},Brotherhood.prototype.setOver=function(a,b){Tawea.models.iframe.set("over",a),!Tawea.models.session.autoHide||Tawea.models.iframe.ignore||b||(a?Tawea.tab.setBoundsIframe(Tawea.models.iframe.bounds.max):Tawea.tab.setBoundsIframe(Tawea.models.iframe.bounds.min))},Tawea.Iframe={close:function(){window.parent.document.getElementById(Tawea.models.session.idIframe).parentNode.removeChild(window.parent.document.getElementById(Tawea.models.session.idIframe))}},Tawea.worker=new WebWorker,Tawea.tab=new Tab(Tawea.models.session.url),Tawea.brotherhood=new Brotherhood;;function css_browser_selector(n){var b=n.toLowerCase(),f=function(c){return b.indexOf(c)>-1},h="gecko",k="webkit",p="safari",j="chrome",d="opera",e="mobile",l=0,a=window.devicePixelRatio?(window.devicePixelRatio+"").replace(".","_"):"1";var i=[(!(/opera|webtv/i.test(b))&&/msie\s(\d+)/.test(b)&&(l=RegExp.$1*1))?("ie ie"+l+((l==6||l==7)?" ie67 ie678 ie6789":(l==8)?" ie678 ie6789":(l==9)?" ie6789 ie9m":(l>9)?" ie9m":"")):(/firefox\/(\d+)\.(\d+)/.test(b)&&(re=RegExp))?h+" ff ff"+re.$1+" ff"+re.$1+"_"+re.$2:f("gecko/")?h:f("opera")?d+(/version\/(\d+)/.test(b)?" "+d+RegExp.$1:(/opera(\s|\/)(\d+)/.test(b)?" "+d+RegExp.$2:"")):f("konqueror")?"konqueror":f("blackberry")?e+" blackberry":f("android")?e+" android":f(j)?k+" "+j:f("crios")?k+" "+j:f("iron")?k+" iron":f("applewebkit/")?k+" "+p+(/version\/(\d+)/.test(b)?" "+p+RegExp.$1:""):f("mozilla/")?h:"",f("j2me")?e+" j2me":f("iphone")?e+" iphone":f("ipod")?e+" ipod":f("ipad")?e+" ipad":f("mac")?"mac":f("darwin")?"mac":f("webtv")?"webtv":f("win")?"win"+(f("windows nt 6.0")?" vista":""):f("freebsd")?"freebsd":(f("x11")||f("linux"))?"linux":"",(a!="1")?" retina ratio"+a:"","js portrait"].join(" ");if(window.jQuery&&!window.jQuery.browser){window.jQuery.browser=l?{msie:1,version:l}:{}}return i}(function(g,b){var c=css_browser_selector(navigator.userAgent);var f=g.documentElement;f.className+=" "+c;var a=c.replace(/^\s*|\s*$/g,"").split(/ +/);b.CSSBS=1;for(var e=0;e<a.length;e++){b["CSSBS_"+a[e]]=1}if(b.jQuery){(function(d){d(b).load(function(){var i="portarit",k="landscape";var j="smart",u="smartwide",v="tablet",q="tabletwide";var w=d(f);var s=0,o=0;function r(){switch(b.orientation){case 90:case -90:w.removeClass(i).addClass(k);break;default:w.removeClass(k).addClass(i);break}}if(w.hasClass("mobile")&&b.orientation!=undefined){d(b).on("orientationchange",r);r()}function h(){try{var l=g.documentElement.clientWidth||g.body.clientWidth;if(l==o){return}o=l;clearTimeout(s)}catch(m){}s=setTimeout(n,100)}function n(){try{w.removeClass(j).removeClass(u).removeClass(v).removeClass(q).removeClass("pc");w.addClass((o<=360)?j:(o<=640)?u:(o<=768)?v:(o<=1024)?q:"pc")}catch(l){}}setTimeout(function(){d(b).on("resize",h);h()},500)})})(b.jQuery)}})(document,window);;Tab.prototype.askData=function(a){var b={youtube:{data:function(a,b){var c=a.data[0].value,d="https://gdata.youtube.com/feeds/api/videos/"+c+"?v=2&alt=json";$.getJSON(d,function(a){this.data.data.push({type:"data",value:a}),this.func(this.data)}.bind({func:b,data:a}))}},vimeo:{data:function(a,b){var c=a.data[0].value,d="http://vimeo.com/api/v2/video/"+c+".json?callback=?";$.getJSON(d,function(a){Tawea.log(a),this.data.data.push({type:"data",value:a}),this.func(this.data)}.bind({func:b,data:a}))}},dailymotion:{data:function(a,b){var c=a.data[0].value,d="https://api.dailymotion.com/video/"+c+"?fields=title,thumbnail_large_url,thumbnail_medium_url,description,aspect_ratio,3d,duration";$.getJSON(d,function(a){Tawea.log(a),this.data.data.push({type:"data",value:a}),this.func(this.data)}.bind({func:b,data:a}))}}};if(console.log("antes de send taw"),b.hasOwnProperty(a.nodeName))for(var c in b)a.nodeName==c&&b[c].data(a,this.sendTaw.bind(this));else this.sendTaw(a)},Tab.prototype.sendTaw=function(a){a.to=Tawea.models.friend.get("id");var b="http://"+window.location.host+"/extension/api/taw/?token="+Tawea.models.session.taweaAccessToken;$.post(b,a,function(a){200==a.meta.code?(Tawea.models.dragBox.set("status","successful"),Tawea.worker.sendMessage(a.data.url)):403==a.meta.code&&Tawea.models.dragBox.set("status","error");var b=document.getElementById("dragBox");b.classList.add("transparent"),setTimeout(function(){this.classList.remove("transparent"),Tawea.models.dragBox.set("drag",!1),Tawea.models.dragBox.set("drop",!1)}.bind(b),1e3)},"json")};;var Notifications=[{type:"cogs",message:"Have you tried the new Tawea feature to share photos and videos"}];;Tawea.models.dragBox=Ember.Object.create({drag:!1,drop:!1,status:"error",social:null}),Tawea.Social={nets:{facebook:{name:"facebook",share:function(a){var b=626,c=436,d=Tawea.Social.position(b,c),e="https://www.facebook.com/sharer/sharer.php?u=";Tawea.worker.openPopup(e+a,"sharer","width="+b+",height="+c+",left="+d.left+",top="+d.top,null,{type:"facebook",url:a,width:b,height:c})}},twitter:{name:"twitter",share:function(a){var b=550,c=420,d=Tawea.Social.position(b,c),e=encodeURIComponent(a),a="https://twitter.com/intent/tweet?original_referer="+e+"&tw_p=tweetbutton&url="+e;Tawea.worker.openPopup(a,"Twitter","width="+b+",height="+c+",left="+d.left+",top="+d.top,null,{type:"twitter",url:a,width:b,height:c})}}},get:function(a,b){for(var c in this.nets)if(document.elementFromPoint(a,b).getAttribute("social")==this.nets[c].name)return this.nets[c].name;return null},position:function(a,b){return{left:screen.width/2-a/2,top:screen.height/2-b/2}}},WebWorker.prototype.onMessage=function(a){if(a.event==Events.workerReady)Tawea.tab.initTawea(a.data.boxesStatus),Tawea.models.session.set("loaded",a.data.dataReady),this.initTawea(),this.initTab();else if(a.event==Events.workerRunning)Tawea.tab.initTawea(a.data.boxesStatus),Tawea.models.session.set("loaded",a.data.dataReady),a.data.init||this.initTawea(),this.initTab();else if(a.event==Events.iframeData){Tawea.models.friends.clear();for(var b in a.data.friends)Tawea.models.friends.pushObject(Tawea.Model.Friend.create({id:a.data.friends[b].id,name:a.data.friends[b].name,registered:!1,statusChat:a.data.friends[b].statusChat,boxStatus:a.data.friends[b].boxStatus,newMessage:!1,devices:a.data.friends[b].devices}));Tawea.models.friends=Tawea.models.friends.sort(function(a,b){return a.get("name").toLowerCase()>b.get("name").toLowerCase()}),Tawea.models.session.set("loaded",!0)}else if(a.event==Events.chatStatus)Tawea.models.session.id!==a.data.id&&Tawea.models.friends.findProperty("id",a.data.id).set("statusChat",a.data.statusChat);else if(a.event==Events.friendsDevices){var c;if("undefined"!=typeof a.data.devices)for(var d=0;d<a.data.devices.length;d++)c=a.data.devices[d],c.hasOwnProperty("devices")&&Tawea.models.friends.findProperty("id",c.id).set("devices",c.devices)}else a.event==Events.chatBoxOpen?Tawea.tab.send(a):a.event==Events.session&&200==a.data.statusCode&&(Tawea.models.session.set("autoHide",a.data.autoHide),Tawea.models.session.set("keepLoggedIn",a.data.keepLoggedIn),Tawea.models.session.set("showAll",a.data.showAll));navigator.userAgent.toLowerCase().indexOf("safari")>=0&&navigator.userAgent.toLowerCase().indexOf("chrome")<0&&Tawea.log(JSON.stringify(a))},WebWorker.prototype.initTab=function(){window.onbeforeunload=this.closeTab.bind(this),this.addTab();var a="follow",b="followStart";if(localStorage.hasOwnProperty(a)){var c=JSON.parse(localStorage[a]);c.event!=Events.requestFollow||sessionStorage.hasOwnProperty(a)||Tawea.tab.send(c)}if(sessionStorage.hasOwnProperty(b)&&sessionStorage.hasOwnProperty("newTab")||sessionStorage.hasOwnProperty(a)&&!sessionStorage.hasOwnProperty("newTab")){var d=!1;if(sessionStorage.hasOwnProperty("follow")){var e=JSON.parse(sessionStorage.follow);e.hasOwnProperty("minimized")&&(d=e.minimized)}var c={event:Events.requestFollow,data:{minimized:d}};Tawea.tab.send(c),sessionStorage.hasOwnProperty(b)&&(sessionStorage[a]=sessionStorage[b],sessionStorage.removeItem(b))}else sessionStorage.removeItem(b),sessionStorage.removeItem(a);sessionStorage.newTab="true"},WebWorker.prototype.addTab=function(){({event:Events.addTab,data:{}})},WebWorker.prototype.closeTab=function(){sessionStorage.removeItem("newTab")},WebWorker.prototype.logout=function(){var a={event:Events.logout};this.send(a)},WebWorker.prototype.chatBoxOpen=function(a,b){var c={event:Events.chatBoxOpen,data:{id:a}};this.send(c),b.stopPropagation&&(b.stopPropagation(),b.preventDefault())},Tab.prototype.onMessage=function(a){a.event==Events.debug?Tawea.send(a.data):a.event==Events.tawDrop?(Tawea.models.dragBox.set("drop",!0),Tawea.models.dragBox.set("status","loading"),Tawea.models.dragBox.set("over",!1),console.log("antes de ask taw msg ="+a),"a"!=a.data.nodeName&&"#text"!=a.data.nodeName?(console.log("ask data"),this.askData(a.data)):(Tawea.models.dragBox.set("status","error"),setTimeout(function(){Tawea.Interface.update(),Tawea.models.dragBox.set("drag",!1),Tawea.models.dragBox.set("drop",!1)},1e3))):a.event==Events.dragEvent?"dragover"==a.data.type?(Tawea.models.dragBox.set("social",Tawea.Social.get(a.data.coordinates.x,a.data.coordinates.y)),Tawea.models.dragBox.set("over",!0)):"dragleave"==a.data.type?Tawea.models.dragBox.set("over",!1):"dragstart"==a.data.type?(Tawea.models.dragBox.set("drag",!0),Tawea.Interface.setDragBox()):"dragend"==a.data.type&&(Tawea.models.dragBox.get("drop")||(Tawea.models.dragBox.set("drag",!1),Tawea.Interface.update()),Tawea.models.dragBox.set("over",!1)):a.event==Events.iframeOver&&Tawea.models.session.autoHide},Tab.prototype.initTawea=function(a){var b={event:Events.taweaInit,data:{boxesStatus:a,autoHide:Tawea.models.session.autoHide}};this.send(b)},Tab.prototype.sendTaw=function(a){var b="http://"+window.location.host+"/extension/api/taw/?token="+Tawea.models.session.taweaAccessToken;console.log(b),$.post(b,a,function(a){if(console.log(a),200==a.meta.code){Tawea.models.dragBox.set("status","successful");for(var b in Tawea.Social.nets)Tawea.models.dragBox.get("social")==Tawea.Social.nets[b].name&&Tawea.Social.nets[b].share(a.data.url)}else 403==a.meta.code&&Tawea.models.dragBox.set("status","error");setTimeout(function(){Tawea.Interface.update(),Tawea.models.dragBox.set("drag",!1),Tawea.models.dragBox.set("drop",!1)},1e3)},"json")},Tawea.ApplicationController=Ember.Controller.extend({session:Tawea.models.session,lang:null,changeTab:function(){Tawea.Interface.update()}.observes("session.statusCode"),closeSession:function(){200!==this.session.statusCode&&(Tawea.models.session.set("loaded",!1),Tawea.models.friends.clear())}.observes("session.statusCode")}),Tawea.ApplicationView=Ember.View.extend({templateName:"application",classNames:["tawea","boxParentV"]}),Tawea.LoginView=Ember.View.extend({templateName:"login",classNames:["login"],displayLabel:"Tawea",click:function(){Tawea.tab.doLogin()},mouseEnter:function(){this.set("displayLabel",Tawea.models.lang.actions.logi)},mouseLeave:function(){this.set("displayLabel","Tawea")}}),Tawea.ErrorView=Ember.View.extend({templateName:"error",classNames:["error"]}),Tawea.MaintenanceView=Ember.View.extend({templateName:"maintenance",classNames:["maintenance"]}),Tawea.DragBoxController=Ember.Controller.extend({dragBoxBinding:"Tawea.models.dragBox"}),Tawea.DragBoxView=Ember.View.extend({templateName:"dragBox",classNames:["dragBox","boxParentV"],overFacebook:function(){return this.controller.dragBox.over&&this.controller.dragBox.social==Tawea.Social.nets.facebook.name}.property("this.controller.dragBox.over","this.controller.dragBox.social"),overTwitter:function(){return this.controller.dragBox.over&&this.controller.dragBox.social==Tawea.Social.nets.twitter.name}.property("this.controller.dragBox.over","this.controller.dragBox.social"),dropFacebook:function(){return this.controller.dragBox.social==Tawea.Social.nets.facebook.name?this.dropStatus(this.controller.dragBox.status):void 0}.property("this.controller.dragBox.status","this.controller.dragBox.social"),dropTwitter:function(){return this.controller.dragBox.social==Tawea.Social.nets.twitter.name?this.dropStatus(this.controller.dragBox.status):void 0}.property("this.controller.dragBox.status","this.controller.dragBox.social"),dropStatus:function(a){var b="icon-remove";return"loading"==a?b="icon-spin icon-spinner":"successful"==a&&(b="icon-ok"),b}}),Tawea.UserController=Ember.Controller.extend({searchFriendBinding:"userFriendsController.searchFriend",friendsBinding:"userFriendsController.friends",loadedBinding:"Tawea.models.session.loaded",indexFriendBinding:"userFriendsController.indexFriend",countFriendsBinding:"userFriendsController.friendsSelected.length",logout:function(){Tawea.tab.doLogout()},isFocus:function(){return Tawea.models.session.get("focus")&&!Tawea.models.session.get("autoHide")||Tawea.models.iframe.get("over")&&Tawea.models.session.get("autoHide")&&Tawea.models.session.get("focus")}.property("Tawea.models.session.focus","Tawea.models.iframe.over","Tawea.models.session.autoHide")}),Tawea.UserView=Ember.View.extend({templateName:"user",classNames:["boxParentV","user"]}),Tawea.SearchField=Ember.TextArea.extend({valueBinding:"context.searchFriend",placeholder:Tawea.models.lang.actions.chat,indexFriendBinding:"context.indexFriend",countFriendsBinding:"context.countFriends",keyDown:function(a){return this._context.target.router.currentHandlerInfos[this._context.target.router.currentHandlerInfos.length-1].name!==Tawea.Interface.names.friends&&Tawea.Interface.setFriends(),13===a.keyCode?(null!==Tawea.models.friendSelected.content&&(Tawea.worker.chatBoxOpen(Tawea.models.friendSelected.content.id,a),Tawea.Interface.setIndex(),this.set("value","")),a.stopPropagation(),a.preventDefault(),!1):(27===a.keyCode?(Tawea.Interface.setIndex(),Tawea.models.session.autoHide&&Tawea.brotherhood.sendOver(!1,!1),this.set("value","")):40===a.keyCode?(this.get("indexFriend")<this.get("countFriends")-1&&this.set("indexFriend",this.get("indexFriend")+1),a.stopPropagation(),a.preventDefault()):38===a.keyCode&&(this.get("indexFriend")>0&&this.set("indexFriend",this.get("indexFriend")-1),a.stopPropagation(),a.preventDefault()),void 0)}}),Tawea.UserIndexView=Ember.View.extend({templateName:"user/index",header:"INDEX USER"}),Tawea.UserFriendsController=Ember.ArrayController.extend({searchFriend:"",friendsBinding:"Tawea.models.friends",friendsSelected:Ember.A([]),indexFriend:-1,intersection:function(a,b){var c,d,e=[];for(c=0;c<a.length;c++)for(d=0;d<b.length;d++)a[c]==b[d]&&e.push(b[d]);return e},searchFriends:function(){this.friendsSelected.clear();var a=this.get("friends"),b=this.get("searchFriend").replace(/\u00a0/g," "),c=b.split(" "),d=[],e=[];if(b){for(var f=0;f<c.length;f++){d[f]=[];for(var g=0;g<a.length;g++)-1!==a[g].get("name").toLowerCase().indexOf(c[f].toLowerCase())&&d[f].push(a[g])}if(e=d[0],c.length>1)for(var g=1;g<c.length;g++)""!==c[g]&&(e=this.intersection(e,d[g]));for(var g=0;g<a.length;g++)for(var h=0;h<e.length;h++){if(-1!==a[g].get("name").indexOf(e[h].get("name"))){a[g].set("display",!0),this.friendsSelected.pushObject(a[g]);break}a[g].set("display",!1)}this.set("indexFriend",0),this.setSelectedFriend()}else{if(Tawea.models.session.get("showAll"))for(var g=0;g<a.length;g++)a[g].get("isConnected")?(a[g].set("display",!0),this.friendsSelected.pushObject(a[g])):a[g].set("display",!1);else for(var g=0;g<a.length;g++)a[g].get("statusChat")?(a[g].set("display",!0),this.friendsSelected.pushObject(a[g])):a[g].set("display",!1);this.set("indexFriend",-1)}return a}.property("friends.@each","friends.@each.showConnectedIcon","searchFriend","Tawea.models.session.showAll"),updateIndexFriend:function(){if(null!==Tawea.models.friendSelected.content){var a=this.friendsSelected.indexOf(Tawea.models.friendSelected.content);a!==this.indexFriend&&this.set("indexFriend",a)}}.observes("Tawea.models.friendSelected.content"),setSelectedFriend:function(){this.friendsSelected&&(-1!==this.indexFriend?Tawea.models.friendSelected.set("content",this.friendsSelected[this.indexFriend]):Tawea.models.friendSelected.set("content",null))}.observes("indexFriend")}),Tawea.UserFriendsView=Ember.View.extend({templateName:"user/friends",classNames:["friends","boxParentV","boxFlex"],header:Tawea.models.lang.actions.chat}),Tawea.models.friendSelected=Ember.Object.create({content:null}),Tawea.FriendView=Ember.View.extend({templateName:"friend",classNames:["friend","boxParentH","boxAlignCenter"],classNameBindings:["friend.isConnected:active","isSelected:selected","friend.display::hidden"],isSelected:function(){var a=Tawea.models.friendSelected.get("content");return this.friend===a?!0:void 0}.property("Tawea.models.friendSelected.content"),click:function(a){Tawea.worker.chatBoxOpen(this.friend.id,a),Tawea.Interface.setIndex(),this._context.set("searchFriend","")},mouseEnter:function(){Tawea.models.friendSelected.set("content",this.friend)}}),Tawea.UserSettingsController=Ember.Controller.extend({logout:function(){Tawea.tab.doLogout()},clickAutoHide:function(){var a={autoHide:!Tawea.models.session.autoHide,keepLoggedIn:Tawea.models.session.keepLoggedIn,showAll:Tawea.models.session.showAll};Tawea.tab.doSettings(a)},clickKeepLogged:function(){var a={autoHide:Tawea.models.session.autoHide,keepLoggedIn:!Tawea.models.session.keepLoggedIn,showAll:Tawea.models.session.showAll};Tawea.tab.doSettings(a)},clickShowOnlyConnected:function(){var a={autoHide:Tawea.models.session.autoHide,keepLoggedIn:Tawea.models.session.keepLoggedIn,showAll:!Tawea.models.session.showAll};Tawea.tab.doSettings(a)},clickReport:function(){Tawea.tab.reportError()}}),Tawea.UserSettingsView=Ember.View.extend({templateName:"user/settings",classNames:["settings"],header:Tawea.models.lang.actions.sett,autoHide:function(){return Tawea.models.session.autoHide}.property("Tawea.models.session.autoHide"),keepLoggedIn:function(){return Tawea.models.session.keepLoggedIn}.property("Tawea.models.session.keepLoggedIn"),showAll:function(){return 0==Tawea.models.session.showAll}.property("Tawea.models.session.showAll")}),Tawea.UserNotificationsController=Ember.ArrayController.extend({notificationsBinding:"Tawea.models.notifications",init:function(){for(var a=0;a<Notifications.length;a++)this.notifications.pushObject(Tawea.Model.Notification.create({id:null,from:null,message:Notifications[a].message,date:null,type:Notifications[a].type}))},closeNotification:function(a){this.notifications.removeObject(a),this.notifications.length<1&&Tawea.Interface.setIndex()}}),Tawea.UserNotificationsView=Ember.View.extend({templateName:"user/notifications",classNames:["notifications","boxParentV","boxFlex"]}),Tawea.NotificationView=Ember.View.extend({templateName:"notification",classNames:["notification","boxParentH","boxFlex"]}),Tawea.Router.map(function(){this.route("login"),this.route("error"),this.route("maintenance"),this.route("dragBox"),this.resource("user",function(){this.route("settings"),this.route("friends"),this.route("notifications")})}),Tawea.Router.reopen({location:"none"}),Tawea.IndexRoute=Ember.Route.extend({redirect:function(){Tawea.Interface.update()}}),Tawea.UserRoute=Ember.Route.extend({events:{goSettings:function(){this.router.router.currentHandlerInfos[this.router.router.currentHandlerInfos.length-1].name!==Tawea.Interface.names.settings?Tawea.Interface.setSettings():Tawea.Interface.setIndex()},goFriends:function(){Tawea.Interface.setFriends()},goIndex:function(){Tawea.Interface.setIndex()},goNotifications:function(){Tawea.Interface.setNotifications()},goLogin:function(){Tawea.models.session.set("statusCode",401)}},setupController:function(a){a.set("userFriendsController",this.controllerFor("user.friends"))}}),Tawea.Interface={names:{login:"login",error:"error",maintenance:"maintenance",dragBox:"dragBox",index:"user.index",settings:"user.settings",friends:"user.friends",notifications:"user.notifications"},bounds:{index:{height:"29px",width:"229px"},settings:{height:"163px"},friends:{height:"519px"},login:{height:"29px",width:"66px"},dragBox:{height:"290px",width:"229px"},notifications:{height:"163px"}},update:function(a){var b=Tawea.models.session.statusCode;401==b?this.setLogin():200==b?(this.setIndex(),a&&Tawea.models.session.autoHide&&Tawea.brotherhood.sendOver(!1,!1)):503==b?this.setMaintenance():this.setError()},setLogin:function(){Tawea.models.iframe.ignore=!1,Tawea.Router.router.transitionTo(this.names.login),Tawea.tab.setBoundsIframe(this.bounds.login)},setError:function(){Tawea.models.iframe.ignore=!1,Tawea.Router.router.transitionTo(this.names.error),Tawea.tab.setBoundsIframe(this.bounds.login)},setMaintenance:function(){Tawea.models.iframe.ignore=!1,Tawea.Router.router.transitionTo(this.names.maintenance),Tawea.tab.setBoundsIframe(this.bounds.login)},setIndex:function(){Tawea.models.iframe.ignore=!1,Tawea.Router.router.transitionTo(this.names.index),Tawea.tab.setBoundsIframe(this.bounds.index)},setFriends:function(){Tawea.models.iframe.ignore=!0,Tawea.Router.router.transitionTo(this.names.friends),Tawea.tab.setBoundsIframe(this.bounds.friends)},setSettings:function(){Tawea.models.iframe.ignore=!0,Tawea.Router.router.transitionTo(this.names.settings),Tawea.tab.setBoundsIframe(this.bounds.settings)},setNotifications:function(){Tawea.models.iframe.ignore=!0,Tawea.Router.router.transitionTo(this.names.notifications),Tawea.tab.setBoundsIframe(this.bounds.notifications)},setDragBox:function(){Tawea.models.iframe.ignore=!0,200==Tawea.models.session.statusCode&&(Tawea.Router.router.transitionTo(this.names.dragBox),Tawea.tab.setBoundsIframe(this.bounds.dragBox))}},window.addEventListener("load",function(){document.onselectstart=function(){return!1}});